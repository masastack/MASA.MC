@inherits LayoutComponentBase
@inject GlobalConfig GlobalConfig
@implements IDisposable

<McLayout NavItems="NavList"
        DefaultRoute="/channels/channelManagement"
        Logo="https://cdn.masastack.com/stack/images/logo/MASAStack/logo-h-en.png"
        MiniLogo="https://cdn.masastack.com/stack/images/logo/MASAStack/logo.png">
    @Body
</McLayout>

@code {
    protected override void OnInitialized()
    {
        GlobalConfig.OnPageModeChanged += base.StateHasChanged;
    }

    private List<Nav> NavList { get; set; } = new();

    protected override Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            NavList = new List<Nav>()
            {
                new Nav("channelManagement", "Permission.ChannelManagement", "mdi-email-outline", "channels/channelManagement", 1),
                new Nav("messageManagement", "Permission.MessageManagement", "mdi-animation", 1, new List<Nav>
                {
                    new Nav("sendMessage", "Permission.SendMessage", "messageTasks/sendMessage", 2, "messageManagement"),
                    new Nav("messageRecord", "Permission.MessageRecord", "messageRecords/messageRecordManagement", 2, "messageManagement"),
                }),
                new Nav("messageTemplateManagement", "Permission.MessageTemplateManagement", "mdi-image-filter-none", 1, new List<Nav>
                {
                    new Nav("sms", "Sms", "messageTemplates/smsTemplateManagement", 2, "messageTemplateManagement"),
                    new Nav("email", "Email", "messageTemplates/emailTemplateManagement", 2, "messageTemplateManagement"),
                    new Nav("websiteMessage", "WebsiteMessage", "messageTemplates/websiteMessageTemplateManagement", 2, "messageTemplateManagement"),
                }),
                new Nav("receiverGroupManagement", "Permission.ReceiverGroupManagement", "mdi-account-group", "receiverGroups/receiverGroupManagement", 1),
            };

            StateHasChanged();
        }

        return base.OnAfterRenderAsync(firstRender);
    }

    public void Dispose()
    {
        GlobalConfig.OnPageModeChanged -= base.StateHasChanged;
    }
}