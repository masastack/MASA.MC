@inherits AdminCompontentBase
<div @ref="Ref">
    <SheetDialog Value="@_visible" ValueChanged="HandleVisibleChanged" Title="@T("Permission.SendMessageTask")">
        <MForm Model="_model" @ref="_form" EnableValidation>
            <div class="sheet-dialog full-height flex-column">
                <div class="mt-6 flex-height-auto overflow-y">
                    <MRow>
                        <MCol>
                            @if (_info.EntityType == MessageEntityType.Ordinary)
                            {
                                <OrdinaryMessageInfo MessageInfoId="_info.EntityId" MessageTask="_info"></OrdinaryMessageInfo>
                            }
                            @if (_info.EntityType == MessageEntityType.Template)
                            {
                                <TemplateMessageInfo MessageTemplateId="_info.EntityId" MessageTask="_info"></TemplateMessageInfo>
                                <MessageVariables @bind-Value="_model.Variables"></MessageVariables>
                            }
                        </MCol>
                        <MCol Class="ml-2">
                            <div class="text-subtitle2">@T("DisplayName.MessageTaskReceiver")</div>
                            <MRadioGroup @bind-Value="_model.ReceiverType"
                                         Row>
                                <MRadio Label="@T("DisplayName.ReceiverType.Assign")"
                                        Value="@ReceiverType.Assign">
                                </MRadio>
                                <MRadio Label="@T("DisplayName.ReceiverType.Broadcast")"
                                        Disabled="_info.Channel?.Type!=ChannelType.WebsiteMessage"
                                        Value="@ReceiverType.Broadcast">
                                </MRadio>
                            </MRadioGroup>
                            @if (_model.ReceiverType == ReceiverType.Assign)
                            {
                                <MInput @bind-Value="_model.Receivers" />
                                <MessageReceivers Class="mt-2" @bind-Value="_model.Receivers.Items" />
                            }
                            <div class="mt-4 text-subtitle2">@T("DisplayName.MessageTaskSendingRule")</div>
                            <MInput @bind-Value="_model.SendingRules" />
                            @if (_info.Channel != null && _info.Channel.Type == ChannelType.Sms)
                            {
                                <MRow>
                                    <MCol>
                                        <MTextField @bind-Value="_model.Sign"
                                                Label="@T("DisplayName.MessageTemplateSign")"
                                                Dense
                                                Outlined
                                                HideDetails="@("auto")">
                                        </MTextField>
                                    </MCol>
                                </MRow>
                            }
                            <MessageSendingRules Class="mt-2" @bind-Value="_model.SendingRules" @bind-SendTime="_model.SendTime" />
                        </MCol>
                    </MRow>
                </div>
                <div Class="d-flex mt-6">
                    <MSpacer></MSpacer>
                    <MButton Color="primary" Class="small-button" OnClick="async() => await HandleOkAsync()">@T("Send")</MButton>
                </div>
            </div>
        </MForm>
    </SheetDialog>
</div>