@inherits AdminCompontentBase
<MRow Class="mt-6">
    <MCol Class="d-flex align-self-stretch">
        <SubjectAutoComplete @ref="_subjectAutoComplete" Class="d-flex" @bind-Value="_userIds" SelectedValues="Value.Select(x=>x.SubjectId).ToList()" OnSelectedItemUpdate="HandleSubjectSelected"></SubjectAutoComplete>
        <MButton Color="fill" Class="d-flex ml-6 rounded-lg btn small-btn pa-0 btn-fill-line" OnClick="_createModal.OpenModalAsync">
            <MIcon Size=18>mdi-plus</MIcon>
            <span>@T("ExternalMember")</span>
        </MButton>
    </MCol>
</MRow>
@if (Value.Count > 0)
{
    <MCard Class="mx-auto overflow-y-auto mt-6 pa-0">
        <MList>
            @foreach (var item in Value)
            {
                <MHover>
                    <MListItem @attributes="context.Attrs" Class="@($"pa-4 {context.Class} {(context.Hover ? "on-hover" : "")}")">
                        <MListItemAvatar Size=40 Class="ma-0" Color="primary" Style="z-index:2">
                            @if (item.Type != ReceiverGroupItemTypes.User)
                            {
                                <MIcon Size=24 Color="fill">mdi-animation</MIcon>
                            }
                            else
                            {
                                @if (string.IsNullOrEmpty(item.Avatar))
                                {
                                    <SEmptyAvatar Value="@item.DisplayName" />
                                }
                                else
                                {
                                    <MImage Src="@item.Avatar"></MImage>
                                }
                            }
                        </MListItemAvatar>
                        <MListItemContent Class="ml-2 pa-0" Style="z-index:2">
                            <MListItemTitle>
                                <span class="btn emphasis2--text">@(item.DisplayName)</span>
                                <div class="d-inline-flex mx-2" style="height: 8px">
                                    <MDivider Vertical />
                                </div>
                                <span class="overline regular2--text">@T($"DisplayName.MessageTaskReceiverTypes.{item.Type}")</span>
                            </MListItemTitle>
                            @if (item.Type == ReceiverGroupItemTypes.User)
                            {
                                <MListItemSubtitle>
                                    <span class="body2 regular2--text">@(item.PhoneNumber)</span>
                                    <div class="d-inline-flex mx-1" style="height: 8px">
                                        <MDivider Vertical />
                                    </div>
                                    <span class="body2 regular2--text">@(item.Email)</span>
                                </MListItemSubtitle>
                            }
                        </MListItemContent>
                        <MOverlay Color="#F6F8FD" Opacity=1 Absolute ZIndex=1 Class="justify-end align-center"
                          Value="@(context.Hover)">
                            <MButton Icon OnClick="()=>RemoveValue(item)">
                                <MIcon Color="#1B2559">mdi-close</MIcon>
                            </MButton>
                        </MOverlay>
                    </MListItem>
                </MHover>
            }
        </MList>
    </MCard>
}
<ExternalUserCreateModal @ref="_createModal" OnOk="HandleOk" />